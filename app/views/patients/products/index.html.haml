.row{:style => "background-color:#f5f4f2;margin:0 0 0 0;"}
  = render 'layouts/messages'

  .panel.panel-default{:style => "margin-bottom:0;"}
    .panel-body

      .row
        .col-xs-12
          - @price_book.each do |prod|

            .row
              .panel.panel-default
                .panel-body
                  .col-xs-4
                    %img{:src => "#{prod.productUrl}", :height => "400", :width => "320"}
                  .col-xs-8
                    .col-xs-12
                      %h2
                        = raw prod.productName
                    .col-xs-12
                      = raw prod.productDescription
                    .col-xs-12{:style => "margin-bottom:20px;margin-top:20px"}
                      .unit_price_cell
                        = number_to_currency(prod.productPrice)
                    .col-xs-8
                      = form_tag do
                        .row
                          .col-xs-12
              
                            .panel.panel-default
                              .panel-body
              
                                .table-responsive
              
                                  %table.table.table-hover
                                    %thead
                                      %tr
                                        %th Quantity
                                        %th Remove
                                        %th Total
              
              
                                    - @cart_items.each do |line|
              
                                      %tr
                                        %td
                                          = number_field_tag 'productline[][qty]', nil, :min => 1, :class => 'product_qty_input', :required => 'required', :value => line.quantity
                                          = hidden_field_tag 'productline[][productId]', line.productId
                                        %td
                                          = button_to 'Remove', {:controller => "cart", :action => "save"}, :method => :post, :params => {:commit => 'remove', :product_id => line.productId, :product_name => line.productName}

                                        %td.total_price_cell
                                          = number_to_currency(0)
              
                    .col-xs-4{:style => "text-align:right;margin-bottom:20px;margin-top:20px;color:white;"}
                      = button_to 'Add to Cart', {:controller => "products", :action => "add_to_cart"}, :method => :post,:class => 'btn', :style => "background-color:#ffc81f; font-size: 2em; font-weight: bold;", :params => {:product_id => prod.productId, :product_name => prod.productName}


:javascript

  $(".product_qty_input").on("input",null,null,function(){

    calculateQuantityTotal($(this));
  });


  function calculateQuantityTotal(thisobj) {

    var productGrandTotal = 0;

    $(".product_qty_input").each(function(){

        var productQuantity =  this.value;

        var productCurrency = $(this).closest("tr").find(".unit_price_cell").text();
        var productPrice = Number(productCurrency.replace(/[^0-9\.]+/g,""));

        var totalPrice = (productPrice * productQuantity);

        productGrandTotal = productGrandTotal + totalPrice;

        console.log(productQuantity);
        console.log(productCurrency);
        console.log(productPrice);
        console.log(totalPrice);
        console.log(productGrandTotal);


        var totalPriceCurrency = "$".concat(totalPrice.toFixed(2).toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1,"));

        $(this).closest("tr").find(".total_price_cell").html(totalPriceCurrency);

      });

      var grandTotalCurrency = "$".concat(productGrandTotal.toFixed(2).toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1,"));
      thisobj.closest("table").find(".grand_total_cell").html(grandTotalCurrency);
  }

  $(function(){
    $(".product_qty_input").each(function(){
      calculateQuantityTotal($(this));
    });
  });